<Window x:Class="TournamentManager.Client.Views.CategoriesManagementWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TournamentManager.Client.Views"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Height="600"
        Width="650"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        ResizeMode="NoResize"
        AllowsTransparency="True">

    <Border BorderBrush="{StaticResource TextSecondaryBrush}" BorderThickness="1" CornerRadius="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Border Background="{StaticResource PrimaryBrush}" Padding="20" CornerRadius="8,8,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel>
                        <TextBlock Text="{Binding WindowTitle}"
                               Foreground="{StaticResource WhiteBrush}"
                               FontSize="18"
                               FontWeight="Bold"/>
                        <TextBlock Text="Управление весовыми и возрастными категориями"
                               Foreground="{StaticResource WhiteBrush}"
                               Opacity="0.9"
                               FontSize="12"
                               Margin="0,4,0,0"/>
                    </StackPanel>

                    <Button Grid.Column="1"
                        Command="{Binding CloseCommand}"
                        Style="{StaticResource IconButtonStyle}"
                        Foreground="{StaticResource WhiteBrush}"
                        ToolTip="Закрыть">
                        <materialDesign:PackIcon Kind="Close" Width="20" Height="20"/>
                    </Button>
                </Grid>
            </Border>

            <Grid Grid.Row="1" Margin="20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="300"/>
                </Grid.ColumnDefinitions>

                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                        <TextBlock Text="Список категорий"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   Margin="0,4,0,0"
                                   Foreground="{StaticResource TextPrimaryBrush}"/>

                        <Button Command="{Binding AddCategoryCommand}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                Margin="12,0,0,0">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Plus" Width="16" Height="16" 
                                                         Foreground="{StaticResource WhiteBrush}" Margin="0,2,4,0"/>
                                <TextBlock Text="Добавить" Foreground="{StaticResource WhiteBrush}"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <Border BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="1"
                            Background="{StaticResource WhiteBrush}"
                            CornerRadius="4">
                        <ListView ItemsSource="{Binding Categories}"
                                  SelectedItem="{Binding SelectedCategory}"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                  Height="363">
                            <ListView.ItemTemplate>
                                <DataTemplate>
                                    <Border Padding="12,8" BorderThickness="0,0,0,1" BorderBrush="{StaticResource BorderBrush}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Text="{Binding DisplayName}"
                                                       FontSize="14"
                                                       FontWeight="SemiBold"
                                                       Foreground="{StaticResource TextPrimaryBrush}"
                                                       VerticalAlignment="Center"/>

                                            <StackPanel Grid.Column="1" 
                                                        Orientation="Horizontal" 
                                                        VerticalAlignment="Center"
                                                        HorizontalAlignment="Right">
                                                <Button Command="{Binding DataContext.EditCategoryCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                        Style="{StaticResource IconButtonStyle}" Margin="4,0,2,0">
                                                    <materialDesign:PackIcon Kind="Pencil" Width="16" Height="16"/>
                                                </Button>
                                                <Button Command="{Binding DataContext.DeleteCategoryCommand, RelativeSource={RelativeSource AncestorType=ListView}}"
                                                        Style="{StaticResource IconButtonStyle}" Foreground="{StaticResource ErrorBrush}" Margin="2,0,4,0">
                                                    <materialDesign:PackIcon Kind="Delete" Width="16" Height="16"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Border>
                </StackPanel>

                <Border Grid.Column="2"
                        Background="{StaticResource WhiteBrush}"
                        Padding="16"
                        CornerRadius="4"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="1"
                        Visibility="{Binding IsEditMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedCategory.Id, StringFormat='{}Редактирование категории {0}'}"
                                       FontSize="16" FontWeight="SemiBold" Foreground="{StaticResource TextSecondaryBrush}"
                                       Margin="0,0,0,16"/>

                            <StackPanel Margin="0,0,0,16">
                                <TextBlock Text="Весовой диапазон (кг)"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           Margin="0,0,0,8"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Text="{Binding SelectedCategory.MinWeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource TextBoxStyle}" materialDesign:HintAssist.Hint="Мин. вес"/>

                                    <TextBlock Grid.Column="1" Text="-"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontWeight="Bold"/>

                                    <TextBox Grid.Column="2" Text="{Binding SelectedCategory.MaxWeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource TextBoxStyle}" materialDesign:HintAssist.Hint="Макс. вес"/>
                                </Grid>
                            </StackPanel>

                            <StackPanel Margin="0,0,0,16">
                                <TextBlock Text="Возрастной диапазон (лет)"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           Margin="0,0,0,8"/>

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBox Text="{Binding SelectedCategory.MinAge, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource TextBoxStyle}"
                                             materialDesign:HintAssist.Hint="Мин. возраст"/>

                                    <TextBlock Grid.Column="1" Text="-" HorizontalAlignment="Center"
                                               VerticalAlignment="Center" FontWeight="Bold"/>

                                    <TextBox Grid.Column="2" Text="{Binding SelectedCategory.MaxAge, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                             Style="{StaticResource TextBoxStyle}" materialDesign:HintAssist.Hint="Макс. возраст"/>
                                </Grid>
                            </StackPanel>

                            <Border Padding="12" CornerRadius="4" BorderBrush="{StaticResource BorderBrush}"
                                    BorderThickness="1" Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="Предпросмотр категории:" FontSize="12" FontWeight="SemiBold"
                                               Foreground="{StaticResource TextSecondaryBrush}" Margin="0,0,0,4"/>
                                    <TextBlock Text="{Binding SelectedCategory.DisplayName}" FontSize="14"
                                               FontWeight="Bold" Foreground="{StaticResource PrimaryBrush}"/>
                                </StackPanel>
                            </Border>

                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="Отмена" Command="{Binding CancelEditCommand}"
                                        Style="{StaticResource SecondaryButtonStyle}" Margin="0,0,8,0"/>
                                <Button Content="Сохранить" Command="{Binding SaveCategoryCommand}"
                                        Style="{StaticResource PrimaryButtonStyle}"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>

            <Border Grid.Row="2" Background="{StaticResource WhiteBrush}"
                    Padding="16" CornerRadius="0,0,8,8">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Закрыть" Command="{Binding CloseCommand}"
                            Style="{StaticResource SecondaryButtonStyle}"/>
                </StackPanel>
            </Border>

            <Border Grid.Row="0" Grid.RowSpan="3" Background="#CC000000"
                    Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}"
                    CornerRadius="8">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ProgressBar IsIndeterminate="True"  Width="100" Height="4" Margin="0,0,0,12"
                                 Style="{StaticResource ProgressBarStyle}"/>
                    <TextBlock Text="Загрузка..." Foreground="{StaticResource WhiteBrush}" 
                               HorizontalAlignment="Center" FontSize="12"/>
                </StackPanel>
            </Border>
        </Grid>
    </Border>
</Window>